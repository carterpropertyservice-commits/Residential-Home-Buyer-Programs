<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Hanover County Homeownership Assistance Eligibility Assessment</title>
    <style>
        /* ==================== CSS VARIABLES ==================== */
        :root {
            --primary: #1a5f7a;
            --primary-dark: #134b5f;
            --primary-light: #e8f4f8;
            --accent: #2d8a6e;
            --accent-light: #e6f5f0;
            --text-primary: #1a1a2e;
            --text-secondary: #4a4a68;
            --text-muted: #6b6b8d;
            --bg-white: #ffffff;
            --bg-cream: #faf9f7;
            --bg-light: #f5f7fa;
            --border: #d1d5db;
            --border-light: #e5e7eb;
            --success: #059669;
            --success-bg: #ecfdf5;
            --warning: #d97706;
            --warning-bg: #fffbeb;
            --error: #dc2626;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius: 8px;
            --radius-lg: 12px;
            --font-display: 'Segoe UI', 'SF Pro Display', system-ui, sans-serif;
            --font-body: 'Segoe UI', 'SF Pro Text', system-ui, sans-serif;
        }

        /* ==================== RESET & BASE ==================== */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-cream);
            min-height: 100vh;
        }

        /* ==================== ACCESSIBILITY ==================== */
        /* Focus states - WCAG 2.1 AA compliant */
        *:focus {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        *:focus:not(:focus-visible) {
            outline: none;
        }

        *:focus-visible {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        /* Skip link for keyboard navigation */
        .skip-link {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            z-index: 1000;
            text-decoration: none;
            font-weight: 600;
        }

        .skip-link:focus {
            top: 1rem;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* ==================== LAYOUT ==================== */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        /* ==================== HEADER ==================== */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2.5rem 1.5rem;
            text-align: center;
        }

        header h1 {
            font-family: var(--font-display);
            font-size: clamp(1.75rem, 4vw, 2.25rem);
            font-weight: 700;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .header-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 0.375rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-light);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-light);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .card-title {
            font-family: var(--font-display);
            font-size: 1.375rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* ==================== FORM ELEMENTS ==================== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .label-hint {
            font-weight: 400;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-left: 0.25rem;
        }

        .required-marker {
            color: var(--error);
            font-weight: 700;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            font-size: 1rem;
            font-family: inherit;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-white);
            color: var(--text-primary);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:hover,
        select:hover,
        textarea:hover {
            border-color: var(--primary);
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.15);
            outline: none;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%234a4a68' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 2.5rem;
        }

        /* Radio and Checkbox groups */
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .option-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--radius);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-item:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .option-item input[type="radio"],
        .option-item input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            margin-top: 0.125rem;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .option-label {
            flex: 1;
        }

        .option-label strong {
            display: block;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .option-label span {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        /* Input prefix (for currency) */
        .input-with-prefix {
            position: relative;
        }

        .input-prefix {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-weight: 600;
        }

        .input-with-prefix input {
            padding-left: 2rem;
        }

        /* Help text */
        .help-text {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        /* Error state */
        .error input,
        .error select {
            border-color: var(--error);
        }

        .error-message {
            color: var(--error);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .error .error-message {
            display: block;
        }

        /* ==================== BUTTONS ==================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border-light);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-large {
            padding: 1.125rem 2.5rem;
            font-size: 1.125rem;
        }

        .btn-block {
            width: 100%;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* ==================== PROGRESS INDICATOR ==================== */
        .progress-bar {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .progress-step {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .progress-step.active {
            color: var(--primary);
            font-weight: 600;
        }

        .progress-step.complete {
            color: var(--success);
        }

        /* ==================== RESULTS SECTION ==================== */
        #results {
            display: none;
        }

        .results-summary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            color: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            text-align: center;
        }

        .results-summary h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .results-count {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .results-label {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .program-card {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
        }

        .program-card.high-match {
            border-left-color: var(--success);
        }

        .program-card.moderate-match {
            border-left-color: var(--warning);
        }

        .program-header {
            padding: 1.5rem;
            background: var(--bg-light);
            border-bottom: 1px solid var(--border-light);
        }

        .program-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .program-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 2rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .match-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 2rem;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .match-badge.high {
            background: var(--success-bg);
            color: var(--success);
        }

        .match-badge.moderate {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .program-body {
            padding: 1.5rem;
        }

        .program-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--radius);
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .program-requirements h4,
        .program-steps h4 {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .program-requirements ul,
        .program-steps ol {
            margin-left: 1.5rem;
            color: var(--text-secondary);
        }

        .program-requirements li,
        .program-steps li {
            margin-bottom: 0.5rem;
        }

        .program-contact {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--primary-light);
            border-radius: var(--radius);
        }

        .contact-title {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .contact-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
        }

        .contact-item a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .contact-item a:hover {
            text-decoration: underline;
        }

        /* ==================== INFO BOX ==================== */
        .info-box {
            padding: 1.25rem;
            border-radius: var(--radius);
            margin: 1rem 0;
        }

        .info-box.tip {
            background: var(--primary-light);
            border-left: 4px solid var(--primary);
        }

        .info-box.warning {
            background: var(--warning-bg);
            border-left: 4px solid var(--warning);
        }

        .info-box.success {
            background: var(--success-bg);
            border-left: 4px solid var(--success);
        }

        .info-box-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ==================== COLLAPSIBLE SECTIONS ==================== */
        .collapsible {
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }

        .collapsible-header {
            padding: 1rem 1.25rem;
            background: var(--bg-light);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            border-radius: var(--radius);
        }

        .collapsible-header:hover {
            background: var(--border-light);
        }

        .collapsible-icon {
            transition: transform 0.2s;
        }

        .collapsible.open .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            display: none;
            padding: 1.25rem;
            border-top: 1px solid var(--border-light);
        }

        .collapsible.open .collapsible-content {
            display: block;
        }

        /* ==================== USER INFO SUMMARY ==================== */
        .user-summary {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
        }

        .user-summary h3 {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .summary-item {
            padding: 0.75rem;
            background: var(--bg-white);
            border-radius: var(--radius);
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .summary-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ==================== PRINT STYLES ==================== */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            body {
                background: white;
                font-size: 11pt;
                line-height: 1.4;
            }

            .container {
                max-width: 100%;
                padding: 0;
            }

            header {
                background: var(--primary) !important;
                padding: 1.5rem;
                page-break-after: avoid;
            }

            .skip-link,
            .btn,
            .btn-group,
            #assessment-form,
            .no-print {
                display: none !important;
            }

            .card {
                box-shadow: none;
                border: 1px solid var(--border);
                page-break-inside: avoid;
                margin-bottom: 1rem;
            }

            .program-card {
                box-shadow: none;
                border: 1px solid var(--border);
                page-break-inside: avoid;
            }

            .results-summary {
                background: var(--primary) !important;
                page-break-after: avoid;
            }

            .program-header {
                background: var(--bg-light) !important;
            }

            .program-contact {
                background: var(--bg-light) !important;
            }

            .contact-item a {
                color: var(--text-primary);
            }

            .contact-item a::after {
                content: " (" attr(href) ")";
                font-size: 0.8em;
                color: var(--text-muted);
            }

            h1, h2, h3 {
                page-break-after: avoid;
            }

            .user-summary {
                page-break-inside: avoid;
            }

            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 1rem;
                padding-bottom: 1rem;
                border-bottom: 2px solid var(--border);
            }

            .print-footer {
                display: block !important;
                margin-top: 2rem;
                padding-top: 1rem;
                border-top: 1px solid var(--border);
                font-size: 0.9rem;
                color: var(--text-muted);
            }
        }

        .print-header,
        .print-footer {
            display: none;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                padding: 1.5rem 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .program-details {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }

            .card-header {
                flex-direction: column;
                text-align: center;
            }
        }

        /* ==================== ANIMATIONS ==================== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .program-card {
            animation: fadeIn 0.4s ease-out forwards;
        }

        .program-card:nth-child(2) { animation-delay: 0.1s; }
        .program-card:nth-child(3) { animation-delay: 0.2s; }
        .program-card:nth-child(4) { animation-delay: 0.3s; }
        .program-card:nth-child(5) { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header>
        <div class="header-badge">New Hanover County, NC</div>
        <h1>Homeownership Assistance Eligibility Assessment</h1>
        <p>Find financial assistance programs to help make your dream of homeownership a reality. Complete this form to discover programs you may qualify for.</p>
    </header>

    <main id="main-content" class="container" role="main">
        <!-- Assessment Form -->
        <section id="assessment-form" aria-labelledby="form-heading">
            <div class="print-header">
                <h2>Homeownership Assistance Eligibility Assessment</h2>
                <p>New Hanover County, NC - Personalized Program Recommendations</p>
            </div>

            <!-- Progress -->
            <div class="progress-steps" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <span class="progress-step active" id="step-1">1. Income</span>
                <span class="progress-step" id="step-2">2. Household</span>
                <span class="progress-step" id="step-3">3. Credit</span>
                <span class="progress-step" id="step-4">4. Location</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>

            <form id="eligibility-form" novalidate>
                <!-- Section 1: Income Information -->
                <div class="card" id="section-income">
                    <div class="card-header">
                        <div class="card-icon" aria-hidden="true">üí∞</div>
                        <div>
                            <h2 class="card-title">Income Information</h2>
                            <p class="card-subtitle">Tell us about your household income</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="monthly-income">
                            Monthly Gross Income <span class="required-marker" aria-label="required">*</span>
                            <span class="label-hint">(before taxes)</span>
                        </label>
                        <div class="input-with-prefix">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="number" 
                                   id="monthly-income" 
                                   name="monthlyIncome" 
                                   required 
                                   min="0" 
                                   step="1"
                                   placeholder="Enter your monthly income"
                                   aria-describedby="income-help income-error">
                        </div>
                        <p class="help-text" id="income-help">Include all sources: wages, Social Security, SSDI, SSI, pensions, etc.</p>
                        <p class="error-message" id="income-error">Please enter a valid monthly income amount.</p>
                    </div>

                    <div class="form-group">
                        <label for="household-size">
                            Household Size <span class="required-marker" aria-label="required">*</span>
                        </label>
                        <select id="household-size" name="householdSize" required aria-describedby="household-error">
                            <option value="">Select number of people in household</option>
                            <option value="1">1 person</option>
                            <option value="2">2 people</option>
                            <option value="3">3 people</option>
                            <option value="4">4 people</option>
                            <option value="5">5 people</option>
                            <option value="6">6 people</option>
                            <option value="7">7 people</option>
                            <option value="8">8+ people</option>
                        </select>
                        <p class="error-message" id="household-error">Please select your household size.</p>
                    </div>

                    <div class="form-group">
                        <fieldset>
                            <legend>
                                <strong>Primary Income Type <span class="required-marker" aria-label="required">*</span></strong>
                            </legend>
                            <div class="option-group" role="radiogroup">
                                <label class="option-item">
                                    <input type="radio" name="incomeType" value="employment" required>
                                    <div class="option-label">
                                        <strong>Employment Income</strong>
                                        <span>Wages, salary, or self-employment</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="incomeType" value="ssdi">
                                    <div class="option-label">
                                        <strong>SSDI (Social Security Disability Insurance)</strong>
                                        <span>Based on work history and disability</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="incomeType" value="ssi">
                                    <div class="option-label">
                                        <strong>SSI (Supplemental Security Income)</strong>
                                        <span>Need-based disability or age-related</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="incomeType" value="retirement">
                                    <div class="option-label">
                                        <strong>Retirement / Pension</strong>
                                        <span>Social Security retirement, pensions</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="incomeType" value="other">
                                    <div class="option-label">
                                        <strong>Other Fixed Income</strong>
                                        <span>VA benefits, child support, alimony, etc.</span>
                                    </div>
                                </label>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <!-- Section 2: Credit & Purchase Information -->
                <div class="card" id="section-credit">
                    <div class="card-header">
                        <div class="card-icon" aria-hidden="true">üìä</div>
                        <div>
                            <h2 class="card-title">Credit & Purchase Details</h2>
                            <p class="card-subtitle">Help us match you with the right programs</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="credit-score">
                            Estimated Credit Score Range <span class="required-marker" aria-label="required">*</span>
                        </label>
                        <select id="credit-score" name="creditScore" required aria-describedby="credit-help credit-error">
                            <option value="">Select your credit score range</option>
                            <option value="below-500">Below 500</option>
                            <option value="500-579">500 - 579</option>
                            <option value="580-619">580 - 619</option>
                            <option value="620-659">620 - 659</option>
                            <option value="660-699">660 - 699</option>
                            <option value="700-749">700 - 749</option>
                            <option value="750-plus">750 or above</option>
                            <option value="unknown">I don't know my score</option>
                        </select>
                        <p class="help-text" id="credit-help">If unsure, you can get a free credit report at <a href="https://www.annualcreditreport.com" target="_blank" rel="noopener">AnnualCreditReport.com</a></p>
                        <p class="error-message" id="credit-error">Please select a credit score range.</p>
                    </div>

                    <div class="form-group">
                        <label for="purchase-price">
                            Desired Home Purchase Price <span class="required-marker" aria-label="required">*</span>
                        </label>
                        <div class="input-with-prefix">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="number" 
                                   id="purchase-price" 
                                   name="purchasePrice" 
                                   required 
                                   min="0" 
                                   step="1000"
                                   placeholder="Enter desired purchase price"
                                   aria-describedby="price-help price-error">
                        </div>
                        <p class="help-text" id="price-help">Maximum varies by program. Most programs cap at $250,000 - $350,000.</p>
                        <p class="error-message" id="price-error">Please enter a desired purchase price.</p>
                    </div>

                    <div class="form-group">
                        <fieldset>
                            <legend>
                                <strong>First-Time Homebuyer? <span class="required-marker" aria-label="required">*</span></strong>
                            </legend>
                            <p class="help-text" style="margin-bottom: 0.75rem;">First-time buyer = have not owned a home in the past 3 years</p>
                            <div class="option-group" role="radiogroup">
                                <label class="option-item">
                                    <input type="radio" name="firstTimeBuyer" value="yes" required>
                                    <div class="option-label">
                                        <strong>Yes</strong>
                                        <span>I have not owned a home in the past 3 years</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="firstTimeBuyer" value="no">
                                    <div class="option-label">
                                        <strong>No</strong>
                                        <span>I currently own or recently owned a home</span>
                                    </div>
                                </label>
                            </div>
                        </fieldset>
                    </div>

                    <div class="form-group">
                        <fieldset>
                            <legend>
                                <strong>Veteran Status</strong>
                            </legend>
                            <div class="option-group" role="radiogroup">
                                <label class="option-item">
                                    <input type="radio" name="veteran" value="yes">
                                    <div class="option-label">
                                        <strong>Yes, I am a veteran or active military</strong>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="veteran" value="no">
                                    <div class="option-label">
                                        <strong>No</strong>
                                    </div>
                                </label>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <!-- Section 3: Location -->
                <div class="card" id="section-location">
                    <div class="card-header">
                        <div class="card-icon" aria-hidden="true">üìç</div>
                        <div>
                            <h2 class="card-title">Location Preference</h2>
                            <p class="card-subtitle">Where are you looking to buy?</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <fieldset>
                            <legend>
                                <strong>Preferred Purchase Location <span class="required-marker" aria-label="required">*</span></strong>
                            </legend>
                            <div class="option-group" role="radiogroup">
                                <label class="option-item">
                                    <input type="radio" name="location" value="wilmington-city" required>
                                    <div class="option-label">
                                        <strong>City of Wilmington (within city limits)</strong>
                                        <span>Eligible for city-specific programs like HOP and CPLP</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="location" value="new-hanover-county">
                                    <div class="option-label">
                                        <strong>New Hanover County (outside Wilmington city limits)</strong>
                                        <span>Eligible for county, state, and federal programs</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="location" value="pender-county">
                                    <div class="option-label">
                                        <strong>Pender County</strong>
                                        <span>Some areas may qualify for USDA rural programs</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="location" value="rural-area">
                                    <div class="option-label">
                                        <strong>Rural Area / Outside metro area</strong>
                                        <span>May qualify for USDA Section 502 Direct Loans</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="location" value="flexible">
                                    <div class="option-label">
                                        <strong>Flexible / Not sure yet</strong>
                                        <span>Show me all available options</span>
                                    </div>
                                </label>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <!-- Section 4: Accessibility Needs -->
                <div class="card" id="section-accessibility">
                    <div class="card-header">
                        <div class="card-icon" aria-hidden="true">‚ôø</div>
                        <div>
                            <h2 class="card-title">Accessibility Requirements</h2>
                            <p class="card-subtitle">Help us identify modification assistance programs</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <fieldset>
                            <legend>
                                <strong>Do you require accessibility modifications?</strong>
                            </legend>
                            <div class="option-group" role="radiogroup">
                                <label class="option-item">
                                    <input type="radio" name="needsAccessibility" value="yes">
                                    <div class="option-label">
                                        <strong>Yes, I need accessibility modifications</strong>
                                        <span>Ramps, widened doorways, bathroom modifications, etc.</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="needsAccessibility" value="no">
                                    <div class="option-label">
                                        <strong>No accessibility modifications needed</strong>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="radio" name="needsAccessibility" value="maybe">
                                    <div class="option-label">
                                        <strong>Possibly in the future</strong>
                                        <span>Include information about available programs</span>
                                    </div>
                                </label>
                            </div>
                        </fieldset>
                    </div>

                    <div class="form-group" id="accessibility-types-group" style="display: none;">
                        <fieldset>
                            <legend>
                                <strong>What types of modifications do you need?</strong>
                                <span class="label-hint">(Select all that apply)</span>
                            </legend>
                            <div class="option-group">
                                <label class="option-item">
                                    <input type="checkbox" name="accessibilityTypes" value="ramps">
                                    <div class="option-label">
                                        <strong>Wheelchair ramps</strong>
                                        <span>Entry/exit ramps for wheelchair access</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="checkbox" name="accessibilityTypes" value="doors">
                                    <div class="option-label">
                                        <strong>Door widening</strong>
                                        <span>Wider doorways for wheelchair clearance</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="checkbox" name="accessibilityTypes" value="bathroom">
                                    <div class="option-label">
                                        <strong>Bathroom modifications</strong>
                                        <span>Roll-in showers, grab bars, raised toilets</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="checkbox" name="accessibilityTypes" value="kitchen">
                                    <div class="option-label">
                                        <strong>Kitchen modifications</strong>
                                        <span>Lowered counters, accessible cabinets</span>
                                    </div>
                                </label>
                                <label class="option-item">
                                    <input type="checkbox" name="accessibilityTypes" value="other">
                                    <div class="option-label">
                                        <strong>Other modifications</strong>
                                        <span>Stairlifts, lever handles, etc.</span>
                                    </div>
                                </label>
                            </div>
                        </fieldset>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">
                            <span aria-hidden="true">üí°</span> Good to Know
                        </div>
                        <p>Several programs offer grants specifically for accessibility modifications, separate from down payment assistance. These can often be combined with other programs.</p>
                    </div>
                </div>

                <!-- Contact Information (Optional) -->
                <div class="card" id="section-contact">
                    <div class="card-header">
                        <div class="card-icon" aria-hidden="true">üìã</div>
                        <div>
                            <h2 class="card-title">Your Information (Optional)</h2>
                            <p class="card-subtitle">For your printed records</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="applicant-name">Your Name</label>
                        <input type="text" id="applicant-name" name="applicantName" placeholder="Enter your name">
                    </div>

                    <div class="form-group">
                        <label for="applicant-phone">Phone Number</label>
                        <input type="tel" id="applicant-phone" name="applicantPhone" placeholder="(910) 555-0123">
                    </div>

                    <div class="form-group">
                        <label for="applicant-email">Email Address</label>
                        <input type="email" id="applicant-email" name="applicantEmail" placeholder="your@email.com">
                    </div>
                </div>

                <!-- Submit -->
                <div class="btn-group" style="justify-content: center; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary btn-large">
                        <span aria-hidden="true">üîç</span> Find My Programs
                    </button>
                </div>
            </form>
        </section>

        <!-- Results Section -->
        <section id="results" aria-labelledby="results-heading" aria-live="polite">
            <div class="print-header">
                <h2>Homeownership Assistance - Program Recommendations</h2>
                <p>New Hanover County, NC | Generated: <span id="print-date"></span></p>
            </div>

            <div class="results-summary">
                <h2 id="results-heading">Your Personalized Results</h2>
                <div class="results-count" id="program-count">0</div>
                <div class="results-label">Programs You May Qualify For</div>
            </div>

            <!-- User Summary -->
            <div class="user-summary" id="user-summary">
                <h3>Your Information Summary</h3>
                <div class="summary-grid" id="summary-content">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Program Results -->
            <div id="program-results">
                <!-- Populated by JavaScript -->
            </div>

            <!-- Additional Resources -->
            <div class="card" id="additional-resources">
                <div class="card-header">
                    <div class="card-icon" aria-hidden="true">üìö</div>
                    <div>
                        <h2 class="card-title">Additional Resources & Support</h2>
                        <p class="card-subtitle">General assistance regardless of program eligibility</p>
                    </div>
                </div>

                <div class="program-details">
                    <div class="detail-item">
                        <div class="detail-label">Help Hub Wilmington</div>
                        <div class="detail-value">
                            <a href="tel:910-344-6995">910-344-6995</a>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">Central resource for community services</p>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">NHC Social Services</div>
                        <div class="detail-value">
                            <a href="tel:910-798-3500">910-798-3500</a>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">Benefits, Medicaid, food assistance</p>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">NC Housing Finance Agency</div>
                        <div class="detail-value">
                            <a href="tel:919-877-5700">919-877-5700</a>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">State housing programs</p>
                    </div>
                </div>

                <div class="info-box tip">
                    <div class="info-box-title">
                        <span aria-hidden="true">üìû</span> Next Steps
                    </div>
                    <ol style="margin-left: 1.25rem; color: var(--text-secondary);">
                        <li>Review the programs listed above that match your situation</li>
                        <li>Contact each program directly using the phone numbers provided</li>
                        <li>Complete any required homebuyer education courses early</li>
                        <li>Gather required documents: ID, income verification, tax returns</li>
                        <li>Consider working with a HUD-approved housing counselor</li>
                    </ol>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="btn-group no-print" style="justify-content: center; margin-top: 2rem;">
                <button type="button" class="btn btn-primary" onclick="window.print()">
                    <span aria-hidden="true">üñ®Ô∏è</span> Print Results
                </button>
                <button type="button" class="btn btn-secondary" onclick="startOver()">
                    <span aria-hidden="true">‚Ü©Ô∏è</span> Start Over
                </button>
            </div>

            <div class="print-footer">
                <p><strong>Disclaimer:</strong> This assessment provides general guidance based on the information you provided. Actual eligibility is determined by each program's administrators. Income limits and program requirements may change. Contact programs directly for current information and to verify your eligibility.</p>
                <p style="margin-top: 0.5rem;">Generated by New Hanover County Homeownership Assistance Eligibility Tool</p>
            </div>
        </section>
    </main>

    <script>
        // ==================== PROGRAM DATA ====================
        const programs = {
            hop: {
                name: "Home Ownership Pool (HOP)",
                type: "City of Wilmington",
                maxAssistance: "$25,000",
                description: "Down payment and closing cost assistance for qualifying Wilmington residents",
                requirements: [
                    "Property must be within Wilmington city limits",
                    "Income at or below 80% Area Median Income",
                    "Must complete HUD-approved homebuyer education",
                    "Must be primary residence",
                    "Must be first-time homebuyer (no ownership in past 3 years)"
                ],
                steps: [
                    "Call the City of Wilmington Community Development office",
                    "Complete intake application",
                    "Provide income documentation",
                    "Complete homebuyer education course",
                    "Get pre-approved with a participating lender"
                ],
                contact: {
                    phone: "910-341-7836",
                    organization: "City of Wilmington Community Development"
                },
                locationRestriction: ["wilmington-city"],
                creditMinimum: "580",
                firstTimeOnly: true
            },
            cplp: {
                name: "Community Partners Loan Pool (CPLP)",
                type: "City of Wilmington",
                maxAssistance: "Up to $50,000 or 20% of purchase price",
                description: "Larger assistance amounts for qualifying Wilmington homebuyers, administered by Kingdom CDC",
                requirements: [
                    "Property must be within Wilmington city limits",
                    "Income limits apply based on household size",
                    "Must complete homebuyer education",
                    "Property must meet housing quality standards"
                ],
                steps: [
                    "Contact Kingdom CDC directly",
                    "Complete CPLP application",
                    "Attend homebuyer education workshop",
                    "Work with approved lender for primary mortgage",
                    "Complete home inspection and closing"
                ],
                contact: {
                    phone: "910-772-4450",
                    organization: "Kingdom CDC"
                },
                locationRestriction: ["wilmington-city"],
                creditMinimum: "580",
                firstTimeOnly: false
            },
            ncHomeAdvantage: {
                name: "NC Home Advantage Mortgage",
                type: "Statewide NC Program",
                maxAssistance: "Up to $15,000 down payment assistance",
                description: "State program providing down payment help with competitive mortgage rates",
                requirements: [
                    "Income limits based on county (typically up to 80% AMI)",
                    "Credit score of 640+ typically required",
                    "Must complete homebuyer education",
                    "Accepts SSDI/SSI as qualifying income",
                    "Property must be in North Carolina"
                ],
                steps: [
                    "Find a participating NC Home Advantage lender",
                    "Get pre-qualified to determine income eligibility",
                    "Complete required homebuyer education",
                    "Apply through your lender",
                    "Down payment assistance applied at closing"
                ],
                contact: {
                    phone: "919-877-5700",
                    organization: "NC Housing Finance Agency",
                    website: "nchfa.com"
                },
                locationRestriction: ["wilmington-city", "new-hanover-county", "pender-county", "rural-area", "flexible"],
                creditMinimum: "620",
                firstTimeOnly: false
            },
            nc1stHomeAdvantage: {
                name: "NC 1st Home Advantage",
                type: "Statewide NC Program",
                maxAssistance: "$15,000",
                description: "Additional $15,000 for first-time buyers and veterans",
                requirements: [
                    "Must be first-time homebuyer OR veteran",
                    "Income limits apply",
                    "Credit score typically 640+",
                    "Must complete homebuyer education",
                    "Can be combined with NC Home Advantage Mortgage"
                ],
                steps: [
                    "Verify first-time buyer or veteran status",
                    "Work with NC Home Advantage participating lender",
                    "Complete homebuyer education if not already done",
                    "Apply through your lender as part of mortgage process"
                ],
                contact: {
                    phone: "919-877-5700",
                    organization: "NC Housing Finance Agency",
                    website: "nchfa.com"
                },
                locationRestriction: ["wilmington-city", "new-hanover-county", "pender-county", "rural-area", "flexible"],
                creditMinimum: "620",
                firstTimeOnly: true,
                veteranEligible: true
            },
            hap: {
                name: "Homeownership Assistance Program (HAP)",
                type: "Eastern NC Regional",
                maxAssistance: "Up to $30,000 plus closing costs",
                description: "Regional program serving Eastern North Carolina with significant assistance",
                requirements: [
                    "Must be in Eastern NC region",
                    "Income at or below 80% AMI",
                    "First-time homebuyer (3-year rule)",
                    "Must complete 8-hour homebuyer education",
                    "Home must be primary residence"
                ],
                steps: [
                    "Contact your regional HAP administrator",
                    "Complete intake and income verification",
                    "Attend 8-hour homebuyer education course",
                    "Work with approved lender",
                    "Complete property inspection and close"
                ],
                contact: {
                    phone: "919-855-3400",
                    organization: "NC Housing Finance Agency - HAP Program"
                },
                locationRestriction: ["wilmington-city", "new-hanover-county", "pender-county", "rural-area", "flexible"],
                creditMinimum: "580",
                firstTimeOnly: true
            },
            habitat: {
                name: "Cape Fear Habitat for Humanity",
                type: "Nonprofit Program",
                maxAssistance: "Affordable home purchase with 0% interest mortgage",
                description: "Build or purchase affordable homes through sweat equity partnership",
                requirements: [
                    "Income between 30-80% Area Median Income",
                    "Demonstrate need for affordable housing",
                    "Willing to complete 'sweat equity' hours",
                    "Able to make affordable monthly payments",
                    "Resident of New Hanover, Pender, or Duplin County"
                ],
                steps: [
                    "Attend a Habitat information session",
                    "Complete application during open enrollment period",
                    "Undergo selection committee review",
                    "Complete required sweat equity hours (200-400 hours)",
                    "Attend homeowner classes",
                    "Close on your Habitat home"
                ],
                contact: {
                    phone: "910-762-4744",
                    organization: "Cape Fear Habitat for Humanity"
                },
                locationRestriction: ["wilmington-city", "new-hanover-county", "pender-county", "flexible"],
                creditMinimum: "none",
                firstTimeOnly: false,
                sweatEquity: true
            },
            usda502: {
                name: "USDA Section 502 Direct Loan",
                type: "Federal Program",
                maxAssistance: "No down payment required + subsidized interest rates",
                description: "Federal program for rural homebuyers with very favorable terms",
                requirements: [
                    "Property must be in USDA-eligible rural area",
                    "Low to very-low income (below 80% AMI)",
                    "U.S. citizen or eligible non-citizen",
                    "Unable to obtain conventional financing",
                    "Meet credit requirements (flexible, case-by-case)"
                ],
                steps: [
                    "Check property eligibility at USDA eligibility map",
                    "Contact local USDA Rural Development office",
                    "Complete application with income documentation",
                    "USDA will process and determine loan amount",
                    "Find eligible property and close"
                ],
                contact: {
                    phone: "919-873-2000",
                    organization: "USDA Rural Development - NC",
                    website: "rd.usda.gov"
                },
                locationRestriction: ["rural-area", "pender-county", "flexible"],
                creditMinimum: "none",
                firstTimeOnly: false,
                ruralOnly: true
            },
            fha: {
                name: "FHA Loan Program",
                type: "Federal Program",
                maxAssistance: "Low down payment (3.5%) + flexible credit requirements",
                description: "Federal loan program with accessible requirements, accepts disability income",
                requirements: [
                    "Credit score 500+ (580+ for 3.5% down payment)",
                    "Steady income for past 2 years (SSDI/SSI qualifies)",
                    "Debt-to-income ratio within guidelines",
                    "Property must meet FHA standards",
                    "Must be primary residence"
                ],
                steps: [
                    "Find an FHA-approved lender",
                    "Get pre-approved with income documentation",
                    "SSDI/SSI award letters serve as income proof",
                    "Find property and make offer",
                    "Complete FHA appraisal and close"
                ],
                contact: {
                    phone: "Contact any FHA-approved lender",
                    organization: "HUD / FHA",
                    website: "hud.gov"
                },
                locationRestriction: ["wilmington-city", "new-hanover-county", "pender-county", "rural-area", "flexible"],
                creditMinimum: "500",
                firstTimeOnly: false
            },
            accessibilityGrant: {
                name: "NC Housing & Home Improvement Assistance",
                type: "Accessibility Modifications",
                maxAssistance: "Varies - covers ramps, door widening, bathroom modifications",
                description: "State funding for accessibility modifications to make homes safe and accessible",
                requirements: [
                    "Must have documented disability or accessibility need",
                    "Income limits may apply",
                    "Home must be primary residence",
                    "Property must meet basic standards"
                ],
                steps: [
                    "Contact NC Housing Finance Agency",
                    "Request accessibility modification assistance",
                    "Provide documentation of disability/need",
                    "Home assessment by qualified contractor",
                    "Modifications completed by approved contractors"
                ],
                contact: {
                    phone: "919-855-3400",
                    organization: "NC Housing Finance Agency"
                },
                locationRestriction: ["wilmington-city", "new-hanover-county", "pender-county", "rural-area", "flexible"],
                creditMinimum: "none",
                firstTimeOnly: false,
                accessibilityProgram: true
            }
        };

        // 2024 Area Median Income limits for New Hanover County (approximate)
        const amiLimits = {
            // 80% AMI limits by household size (annual)
            1: 52100,
            2: 59550,
            3: 67000,
            4: 74400,
            5: 80400,
            6: 86350,
            7: 92350,
            8: 98300
        };

        // ==================== FORM HANDLING ====================
        const form = document.getElementById('eligibility-form');
        const resultsSection = document.getElementById('results');
        const formSection = document.getElementById('assessment-form');

        // Show/hide accessibility types based on selection
        document.querySelectorAll('input[name="needsAccessibility"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const typesGroup = document.getElementById('accessibility-types-group');
                typesGroup.style.display = (this.value === 'yes' || this.value === 'maybe') ? 'block' : 'none';
            });
        });

        // Update progress bar
        function updateProgress() {
            const formData = new FormData(form);
            let completed = 0;
            const sections = ['monthlyIncome', 'householdSize', 'creditScore', 'location'];
            
            sections.forEach((field, index) => {
                if (formData.get(field)) {
                    completed++;
                    document.getElementById(`step-${index + 1}`).classList.add('complete');
                    document.getElementById(`step-${index + 1}`).classList.remove('active');
                } else if (completed === index) {
                    document.getElementById(`step-${index + 1}`).classList.add('active');
                }
            });

            const progress = (completed / sections.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        form.addEventListener('input', updateProgress);
        form.addEventListener('change', updateProgress);

        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate required fields
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                const formGroup = field.closest('.form-group') || field.closest('fieldset').parentElement;
                if (!field.value || (field.type === 'radio' && !form.querySelector(`input[name="${field.name}"]:checked`))) {
                    formGroup.classList.add('error');
                    isValid = false;
                } else {
                    formGroup.classList.remove('error');
                }
            });

            if (!isValid) {
                // Focus first error
                const firstError = form.querySelector('.error input, .error select');
                if (firstError) firstError.focus();
                return;
            }

            // Gather form data
            const formData = new FormData(form);
            const userData = {
                monthlyIncome: parseFloat(formData.get('monthlyIncome')),
                annualIncome: parseFloat(formData.get('monthlyIncome')) * 12,
                householdSize: parseInt(formData.get('householdSize')),
                incomeType: formData.get('incomeType'),
                creditScore: formData.get('creditScore'),
                purchasePrice: parseFloat(formData.get('purchasePrice')),
                firstTimeBuyer: formData.get('firstTimeBuyer') === 'yes',
                veteran: formData.get('veteran') === 'yes',
                location: formData.get('location'),
                needsAccessibility: formData.get('needsAccessibility'),
                accessibilityTypes: formData.getAll('accessibilityTypes'),
                applicantName: formData.get('applicantName'),
                applicantPhone: formData.get('applicantPhone'),
                applicantEmail: formData.get('applicantEmail')
            };

            // Process eligibility
            const eligiblePrograms = determineEligibility(userData);
            displayResults(userData, eligiblePrograms);
        });

        // ==================== ELIGIBILITY LOGIC ====================
        function determineEligibility(userData) {
            const eligible = [];
            const amiLimit = amiLimits[userData.householdSize] || amiLimits[8];
            const isUnder80AMI = userData.annualIncome <= amiLimit;

            // Credit score ranking
            const creditRanks = {
                'below-500': 1,
                '500-579': 2,
                '580-619': 3,
                '620-659': 4,
                '660-699': 5,
                '700-749': 6,
                '750-plus': 7,
                'unknown': 3 // Assume moderate for unknown
            };
            const userCreditRank = creditRanks[userData.creditScore] || 3;

            for (const [key, program] of Object.entries(programs)) {
                let matchLevel = 'high';
                let eligible_flag = true;
                let notes = [];

                // Check location restriction
                if (!program.locationRestriction.includes(userData.location) && 
                    !program.locationRestriction.includes('flexible')) {
                    eligible_flag = false;
                    continue;
                }

                // Check first-time buyer requirement
                if (program.firstTimeOnly && !userData.firstTimeBuyer && !userData.veteran) {
                    if (!program.veteranEligible) {
                        eligible_flag = false;
                        continue;
                    }
                }

                // Check credit score
                const programCreditRanks = {
                    'none': 0,
                    '500': 2,
                    '580': 3,
                    '620': 4,
                    '640': 5
                };
                const requiredCreditRank = programCreditRanks[program.creditMinimum] || 0;
                
                if (userCreditRank < requiredCreditRank) {
                    if (userData.creditScore === 'unknown') {
                        matchLevel = 'moderate';
                        notes.push('Credit score verification needed');
                    } else {
                        matchLevel = 'moderate';
                        notes.push('Credit score may be below program minimum');
                    }
                }

                // Check income (most programs require under 80% AMI)
                if (!isUnder80AMI && !program.accessibilityProgram && key !== 'fha') {
                    matchLevel = 'moderate';
                    notes.push('Income may exceed program limits');
                }

                // Special handling for rural programs
                if (program.ruralOnly && userData.location !== 'rural-area' && userData.location !== 'flexible') {
                    if (userData.location === 'pender-county') {
                        notes.push('Some Pender County areas may qualify as rural');
                    } else {
                        eligible_flag = false;
                        continue;
                    }
                }

                // Only show accessibility program if user needs it
                if (program.accessibilityProgram && userData.needsAccessibility === 'no') {
                    continue;
                }

                if (eligible_flag) {
                    eligible.push({
                        key,
                        program,
                        matchLevel,
                        notes
                    });
                }
            }

            // Sort by match level (high first) then by max assistance
            eligible.sort((a, b) => {
                if (a.matchLevel === 'high' && b.matchLevel !== 'high') return -1;
                if (a.matchLevel !== 'high' && b.matchLevel === 'high') return 1;
                return 0;
            });

            return eligible;
        }

        // ==================== DISPLAY RESULTS ====================
        function displayResults(userData, eligiblePrograms) {
            // Hide form, show results
            formSection.style.display = 'none';
            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });

            // Set date for print
            document.getElementById('print-date').textContent = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Update count
            document.getElementById('program-count').textContent = eligiblePrograms.length;

            // Build user summary
            const summaryContent = document.getElementById('summary-content');
            const locationLabels = {
                'wilmington-city': 'Wilmington City',
                'new-hanover-county': 'New Hanover County',
                'pender-county': 'Pender County',
                'rural-area': 'Rural Area',
                'flexible': 'Flexible'
            };
            const incomeTypeLabels = {
                'employment': 'Employment',
                'ssdi': 'SSDI',
                'ssi': 'SSI',
                'retirement': 'Retirement/Pension',
                'other': 'Other Fixed Income'
            };

            summaryContent.innerHTML = `
                ${userData.applicantName ? `
                <div class="summary-item">
                    <div class="summary-label">Name</div>
                    <div class="summary-value">${escapeHtml(userData.applicantName)}</div>
                </div>` : ''}
                <div class="summary-item">
                    <div class="summary-label">Monthly Income</div>
                    <div class="summary-value">$${userData.monthlyIncome.toLocaleString()}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Annual Income</div>
                    <div class="summary-value">$${userData.annualIncome.toLocaleString()}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Household Size</div>
                    <div class="summary-value">${userData.householdSize} ${userData.householdSize === 1 ? 'person' : 'people'}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Income Type</div>
                    <div class="summary-value">${incomeTypeLabels[userData.incomeType]}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Credit Score</div>
                    <div class="summary-value">${userData.creditScore === 'unknown' ? 'Unknown' : userData.creditScore}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Target Price</div>
                    <div class="summary-value">$${userData.purchasePrice.toLocaleString()}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Location</div>
                    <div class="summary-value">${locationLabels[userData.location]}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">First-Time Buyer</div>
                    <div class="summary-value">${userData.firstTimeBuyer ? 'Yes' : 'No'}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Veteran</div>
                    <div class="summary-value">${userData.veteran ? 'Yes' : 'No'}</div>
                </div>
            `;

            // Build program cards
            const programResults = document.getElementById('program-results');
            programResults.innerHTML = '';

            if (eligiblePrograms.length === 0) {
                programResults.innerHTML = `
                    <div class="info-box warning">
                        <div class="info-box-title">
                            <span aria-hidden="true">‚ö†Ô∏è</span> Limited Program Matches
                        </div>
                        <p>Based on your current information, you may not qualify for the standard assistance programs. However, we recommend:</p>
                        <ul style="margin-left: 1.25rem; margin-top: 0.5rem;">
                            <li>Contact Help Hub Wilmington (910-344-6995) for personalized guidance</li>
                            <li>Speak with an FHA-approved lender about your options</li>
                            <li>Consider a HUD-approved housing counselor for free advice</li>
                        </ul>
                    </div>
                `;
                return;
            }

            eligiblePrograms.forEach(({ program, matchLevel, notes }) => {
                const card = document.createElement('div');
                card.className = `program-card ${matchLevel === 'high' ? 'high-match' : 'moderate-match'}`;
                
                card.innerHTML = `
                    <div class="program-header">
                        <div class="program-name">${program.name}</div>
                        <div>
                            <span class="program-type">${program.type}</span>
                            <span class="match-badge ${matchLevel}">${matchLevel === 'high' ? '‚úì Good Match' : '? Possible Match'}</span>
                        </div>
                    </div>
                    <div class="program-body">
                        <p style="margin-bottom: 1rem; color: var(--text-secondary);">${program.description}</p>
                        
                        <div class="program-details">
                            <div class="detail-item">
                                <div class="detail-label">Maximum Assistance</div>
                                <div class="detail-value">${program.maxAssistance}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Credit Requirement</div>
                                <div class="detail-value">${program.creditMinimum === 'none' ? 'Flexible' : program.creditMinimum + '+'}</div>
                            </div>
                        </div>

                        ${notes.length > 0 ? `
                        <div class="info-box warning" style="margin-bottom: 1rem;">
                            <div class="info-box-title">
                                <span aria-hidden="true">‚ÑπÔ∏è</span> Notes
                            </div>
                            <ul style="margin-left: 1rem;">
                                ${notes.map(note => `<li>${note}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}

                        <div class="program-requirements">
                            <h4><span aria-hidden="true">üìã</span> Requirements</h4>
                            <ul>
                                ${program.requirements.map(req => `<li>${req}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="program-steps" style="margin-top: 1rem;">
                            <h4><span aria-hidden="true">üë£</span> Next Steps</h4>
                            <ol>
                                ${program.steps.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>

                        <div class="program-contact">
                            <div class="contact-title">Contact Information</div>
                            <div class="contact-info">
                                <div class="contact-item">
                                    <span aria-hidden="true">üè¢</span>
                                    ${program.contact.organization}
                                </div>
                                <div class="contact-item">
                                    <span aria-hidden="true">üìû</span>
                                    <a href="tel:${program.contact.phone.replace(/[^0-9]/g, '')}">${program.contact.phone}</a>
                                </div>
                                ${program.contact.website ? `
                                <div class="contact-item">
                                    <span aria-hidden="true">üåê</span>
                                    <a href="https://${program.contact.website}" target="_blank" rel="noopener">${program.contact.website}</a>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;

                programResults.appendChild(card);
            });
        }

        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Start over function
        function startOver() {
            formSection.style.display = 'block';
            resultsSection.style.display = 'none';
            form.reset();
            document.getElementById('progress-fill').style.width = '0%';
            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('complete', 'active');
            });
            document.getElementById('step-1').classList.add('active');
            document.getElementById('accessibility-types-group').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize progress
        updateProgress();
    </script>
</body>
</html>
